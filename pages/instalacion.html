<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Instalación</title>
        <link rel="stylesheet" href="/investigacion/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/investigacion/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li><a href="/investigacion/pages/contacto.html">Contacto</a></li>
                    <li><a href="/investigacion/pages/como-contribuir.html">Cómo Contribuir</a></li>
                    <li><a href="/investigacion/core.html">CORE: Módulo de Gestión Centralizada</a></li>
                    <li><a href="/investigacion/cvn.html">CVN: Módulo de Gestión del Currículum Vitae Normalizado</a></li>
                    <li><a href="/investigacion/">Portal del Investigador</a></li>
                    <li class="active"><a href="/investigacion/pages/instalacion.html">Instalación</a></li>
                    <li><a href="/investigacion/pages/desarrolladores.html">Desarrolladores</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
    <h1 class="entry-title">Instalación</h1>
    
    <p>
    La presente guía de instalación proporciona el paso a paso de la instalación y configuración del proyecto bajo un entorno con sistema operativo GNU/Linux, concretamente Ubuntu.
</p>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">1. Clonar el repositorio con sus submódulos</li>
    </ul>
    <div class="content">
        <pre>git clone --recursive https://github.com/tic-ull/investigacion.git</pre>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">2. Instalar dependencias</li>
    </ul>
    <div class="content">
        <div class="alert alert-warning">
            Para la instalación de dependencias de módulos Python se emplea <i>pip</i>. 
            Se recomienda el uso de <i>virtualenv</i> junto con esta herramienta, aunque 
            en las instrucciones no se entrará a explicar su funcionamiento.
        </div>
<pre>
sudo apt-get install python-pip
sudo pip install -U distribute
sudo apt-get install postgresql postgresql-client postgresql-contrib libpq-dev \
                     libxml2-dev libxslt1-dev python-dev xvfb redis-server
sudo pip install -r requirements.txt
</pre>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">3. Configurar el proyecto y sus aplicaciones</li>
    </ul>
    <div class="content">
        <p>
            Tanto en el proyecto como en las aplicaciones, los parámetros de configuración se establecen en los ficheros <i>settings.py</i>. 
            Varios de estos parámetros necesitan ser sobreescritos, para ello se emplean los ficheros <i>settings_local.py</i>.
            Se proporcionan los ficheros <i>settings_local-sample.py</i> como ejemplo, se recomienda su uso como punto de partida.
        </p>

        <h4>Configuración del Proyecto Investigación</h4>
        <div class="alert alert-info">
            investigacion/settings_local.py
        </div>
        <pre>cp investigacion/settings_local-sample.py investigacion/settings_local.py</pre>
        <table class="table table-striped table-condensed">
            <tr>
                <th>VARIABLE</th>
                <th>DESCRIPCIÓN</th>
                <th>TIPO</th>
            </tr>
            <tr>
                <td>BASE_URL</td>
                <td><i>URL</i> de la página principal del proyecto. Por defecto es un servicio externo</td>
                <td>string</td>
            </tr>
            <tr>
                <td>SECRET_KEY</td>
                <td colspan="2">
                    <a href="https://docs.djangoproject.com/en/1.7/ref/settings/#secret-key" target="_blank">https://docs.djangoproject.com/en/1.7/ref/settings/#secret-key</a>
                </td>
            </tr>
            <tr>
                <td>DEBUG</td>
                <td colspan="2">
                    <a href="https://docs.djangoproject.com/en/1.7/ref/settings/#std:setting-DEBUG" target="_blank">https://docs.djangoproject.com/en/1.7/ref/settings/#std:setting-DEBUG</a>
                </td>
            </tr>   
            <tr>
                <td>TEMPLATE_DEBUG</td>
                <td colspan="2">
                    <a href="https://docs.djangoproject.com/en/1.7/ref/settings/#template-debug" target="_blank">https://docs.djangoproject.com/en/1.7/ref/settings/#template-debug</a>
                </td>
            </tr>
            <tr>
                <td>DEVEL</td>
                <td>Si DEVEL es True (Entorno de Desarrollo), el servidor de aplicaciones de Django servirá los ficheros estáticos. En otro caso, deberá hacerse desde el Servidor Web del sistema</td>
                <td>boolean</td>
            </tr>
            <tr>
                <td>ADMINS</td>
                <td colspan="2">
                    <a href="https://docs.djangoproject.com/en/1.7/ref/settings/#std:setting-ADMINS" target="_blank">https://docs.djangoproject.com/en/1.7/ref/settings/#std:setting-ADMINS</a>
                </td>
            </tr>
            <tr>
                <td>SUPPORT</td>
                <td>Nombre del Departamento de Soporte que se le mostrará al usuario en caso de error</td>
                <td>string</td>
            </tr>
            <tr>
                <td>EMAIL_SUPPORT</td>
                <td>Correo Electrónico del Departamento de Soporte que se le mostrará al usuario en caso de error</td>
                <td>string</td>
            </tr>
            <tr>
                <td>CAS_SERVER_URL</td>
                <td>URL del <a href="autenticacion.html">Servicio de Autenticación</a> (CAS)</td>
                <td>string</td>
            </tr>
            <tr>
                <td>WS_SERVER_URL</td>
                <td><i>URL</i> base del Servicio de <a href="web-services.html">Web Services</a></td>
                <td>string</td>
            </tr>           
        </table>
        <h4>Configuración de las aplicaciones</h4>
        <ul>
            <li><a href="cvn.html#configuracion">Configuración de la aplicación CVN</a></li>
        </ul>
    </div>

</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">4. Configurar bases de datos</li>
    </ul>
    <div class="content">
        <div class="alert alert-warning">
            Se recomienda el uso de PostgreSQL como Sistema Gestor de Bases de Datos. 
            No se entrará a detallar la configuración del SGBD ni el proceso de creación de usuarios o bases de datos.
        </div>
        <h4>Base de Datos por defecto</h4>
        <p>
            La base de datos puede configurarse sobreescribiendo los valores por defecto en <i>investigacion/settings_local.py</i> siguiendo el formato que se indica en la <a href="https://docs.djangoproject.com/en/dev/ref/settings/#databases" target="_blank">documentación de Django</a>. 
            Una vez configurada, se deben ejecutar los siguientes comandos:
        </p>
<pre>
python manage.py makemigrations
python manage.py migrate
</pre>
        <h4 id="bbddh">Base de Datos histórica</h4>
        <p>
            Para la realización de Informes de Producción Científica extraídos de los CVN se puede clonar la base de datos por defecto a una base de datos histórica de sólo lectura. 
            Cada base de datos histórica se debe añadir a la configuración de base de datos de Django en <i>investigacion/settings_local.py</i>, 
            y posteriormente al diccionario <i>HISTORICAL</i> cumpliendo con el siguiente formato:
        </p>
<pre>
HISTORICAL = {
    '2013': 'nombre_bbdd_historica_2013',
    '2014': 'nombre_bbdd_historica_2014',
    ...
}
</pre>
    </div>
</div>

<div class="section"><ul class="nav nav-tabs header"><li class="active">5. Adaptación de sistema de autenticación</li></ul>
<div class="content">

    <p>
        El sistema usado actualmente para la autentificación es CAS, con un <i>backend</i> basado en django-cas.
        CAS es un sistema de <i>single sign-on</i>, y por esto la aplicación no incluye formulario de inicio de sesión ni de registro de usuarios, sino que el usuario se crea si no existe al aceptar sus credenciales.
    </p>

    <p>
        Se puede cambiar el sistema de autenticación actual por uno diferente de manera sencilla, siempre que se maneje externamente registro e inicio de sesión.
        Sólo es necesario crear un nuevo <i>backend</i> de autenticación o adaptar uno ya existente sobreescribiendo la función <code>authenticate</code> para asegurarse de que se cumplen las siguientes condiciones:
    </p>

    * Si se aceptan las credenciales se debe llamar a <code>UserProfile.get_or_create_user</code> pasando el <i>username</i> y el documento (nif/nie, pasaporte, etc.).

    * Se debe introducir en <code>request.session['attributes']</code> un <i>json</i> con información sobre el usuario con una estructura similar a la del siguiente ejemplo:

    <pre>
    {'TipoCuenta': 'personal',
     'username': 'jpcastro',
     'first_name': 'Juan Pablo',
     'last_name': 'Hernández Castro',
     'NumDocumento': '50496810B',
     'email': 'jpcastro@gemail.com'}
    </pre>

    <table class="table table-striped table-condensed">
        <tr>
            <th>CLAVE</th>
            <th>DESCRIPCIÓN</th>
            <th>USADO FUERA DEL BACKEND POR DEFECTO</th>
        </tr>
        <tr>
            <td>TipoCuenta</td>
            <td>Tipo de usuario. Se bloquean los tipos que se encuentren en la lista settings.CAS_TIPO_CUENTA_NOAUT</td>
            <td>No</td>
        </tr>
        <tr>
            <td>username</td>
            <td>Nombre de usuario para inicio de sesión</td>
            <td>Sí</td>
        </tr>
        <tr>
            <td>first_name</td>
            <td>Nombre del usuario</td>
            <td>Sí</td>
        </tr>
        <tr>
            <td>last_name</td>
            <td>Apellidos del usuario</td>
            <td>Sí</td>
        </tr>
        <tr>
            <td>NumDocumento</td>
            <td>Documento identificatorio del usuario.</td>
            <td>No</td>
        </tr>
        <tr>
            <td>email</td>
            <td>Correo electrónico del usuario</td>
            <td>Sí</td>
        </tr>
    </table>

    <div class="alert alert-warning">
    <p>
        Usar un sistema de inicio de sesión integrado en la aplicación requeriría mayores cambios que los indicados en esta página y que no se va a entrar a detallar, pero se debe tener en cuenta que independientemente del método, la creación de usuarios debe realizarse siempre a través de <code>UserProfile.get_or_create_user</code>.
    </p>
    </div>
</div>

</div>

<div class="section"><ul class="nav nav-tabs header"><li class="active">6. Creación de Web Services</li></ul>
<div class="content">
    <p>
        Parte de la funcionalidad del Portal del Investigador requiere de la existencia de <i>web services</i> que provean la información necesaria.
        Esta funcionalidad no es esencial, y puede ser deshabilitada si no fuera necesaria.
        La información necesaria para construir estos <i>web services</i> se puede encontrar en las secciones correspondientes de cada aplicación:
        <ul>
            <li><a href="core.html#webservices">CORE</a></li>
            <li><a href="cvn.html#webservices">CVN</a></li>
        </ul>
</div>
</div>
</section>
        <section id="extras" class="body">
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>