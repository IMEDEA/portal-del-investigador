<!DOCTYPE html>
<html lang="es"
>
<head>
    <title>Admin Commands - Portal del Investigador</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Favicon -->
    <link rel="shortcut icon" href="//static.ull.es/v3/dist/img/favicon.ico">
    <!--[if IE]><link rel="shortcut icon" href="//static.ull.es/v3/dist/img/favicon.ico"><![endif]-->
    <!-- Touchicon -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="//static.ull.es/v3/dist/img/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="//static.ull.es/v3/dist/img/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="//static.ull.es/v3/dist/img/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="//static.ull.es/v3/dist/img/apple-touch-icon-57-precomposed.png">

<link rel="canonical" href="/investigacion/admin-commands.html">

        <meta name="author" content="Universidad de La Laguna" />
        <meta name="description" content="CRON Los siguientes comandos de administración necesitan ser ejecutados regularmente, por lo que es necesaria su inclusión en el CRON del sistema. Actualización del Código de RRHH de los usuarios core/management/commands/sync_rrhh.py Actualiza el Código de Recursos Humanos de cada usuario (campo rrhh_code del modelo UserProfile). Este ..." />

    <meta property="og:site_name" content="Portal del Investigador" />
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Admin Commands"/>
    <meta property="og:url" content="/investigacion/admin-commands.html"/>
    <meta property="og:description" content="CRON Los siguientes comandos de administración necesitan ser ejecutados regularmente, por lo que es necesaria su inclusión en el CRON del sistema. Actualización del Código de RRHH de los usuarios core/management/commands/sync_rrhh.py Actualiza el Código de Recursos Humanos de cada usuario (campo rrhh_code del modelo UserProfile). Este ..." />


    <!-- ULL -->
    <link rel="stylesheet" href="//static.ull.es/v3/dist/css/ull.min.css" type="text/css"/>

    <link href="/investigacion/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/investigacion/theme/css/style.css" type="text/css"/>
    <noscript><style> .jsonly { display: none } </style></noscript>


</head>
<body>

<div class="navbar navbar-default navbar-ull" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-app-collapse">
                <span class="sr-only">Desplegar menú de aplicación</span>
                <span class="fa fa-bars fa-stack"></span>
            </button>
<!--
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-main-collapse">
                <span class="sr-only">Desplegar menú de navegación</span>
                <span class="fa fa-link fa-stack"></span>
            </button>
-->
            <a class="navbar-brand" href="http://www.ull.es" title="Universidad de La Laguna">Universidad de La Laguna</a>
        </div>
<!--
        <div class="collapse navbar-collapse navbar-main-collapse">
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contacto <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a target="_blank" href="http://www.ull.es"><i class="fa fa-globe"></i> Página Web ULL</a></li>
                        <li><a target="_blank" title="Formulario de contacto" href="http://www.ull.es/view/institucional/ull/Contacto_3/es"><i class="fa fa-list-alt"></i> Formulario de contacto</a></li>
                        <li><a target="_blank" title="Teléfonos" href="http://www.ull.es/view/institucional/ull/Telefonos/es"><i class="fa fa-phone"></i> Directorio telefónico</a></li>
                        <li class="divider"></li>
                        <li>
                            <ul class="rrss text-muted list-inline">
                                <li><a target="_blank" href="http://www.facebook.com/universidaddelalaguna"><i class="fa fa-facebook-square"></i></a></li>
                                <li><a target="_blank" href="http://www.tuenti.com/#m=Page&amp;func=index&amp;page_key=1_160_68944913"><i class="fa fa-tumblr-square"></i></a></li>
                                <li><a target="_blank" href="http://twitter.com/CanalULL"><i class="fa fa-twitter-square"></i></a></li>
                                <li><a target="_blank" href="http://www.linkedin.com/groups/Universidad-Laguna-2656178"><i class="fa fa-linkedin-square"></i></a></li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
-->
    </div>
</div>
<div class="navbar navbar-default navbar-app" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
                <ol class="breadcrumb">
                    <li class="active"><a href="/investigacion/">Portal del Investigador</a></li>
                </ol>
        </div>
        <div class="collapse navbar-collapse navbar-app-collapse">
            <ul class="nav navbar-nav navbar-right">
                         <li><a href="/investigacion/">Inicio</a></li>
                         <li><a href="/investigacion/instalacion.html">Instalación</a></li>
                         <li class="active"><a href="/investigacion/admin-commands.html">Admin Commands</a></li>
                         <li><a href="/investigacion/signals-y-receivers.html">Signals y Receivers</a></li>
                         <li><a href="/investigacion/web-services.html">Web Services</a></li>
                         <li><a href="/investigacion/autenticacion.html">Autenticación</a></li>
                         <li><a href="/investigacion/parseo-de-un-cvn-pdf.html">Parseo de un CVN-PDF</a></li>
                         <li><a href="/investigacion/exportar-a-un-cvn-pdf.html">Exportar a un CVN-PDF</a></li>
                         <li><a href="/investigacion/como-contribuir.html">Cómo Contribuir</a></li>
                         <li><a href="/investigacion/desarrolladores.html">Desarrolladores</a></li>
                         <li><a href="/investigacion/contacto.html">Contacto</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<div class="container-fluid">
    <div class="row">
        <div class="col-md-9" role="main">

    <section id="content" class="body">
        <h1 class="entry-title">Admin Commands</h1>
        
        <div class="entry-content">
            <h1 class="page-header">CRON</h1>

<p>
    Los siguientes comandos de administración necesitan ser ejecutados regularmente, por lo que es necesaria su inclusión en el CRON del sistema.
</p>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Actualización del Código de RRHH de los usuarios</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>core/management/commands/sync_rrhh.py</b></div>
            <p>
                Actualiza el Código de Recursos Humanos de cada usuario (campo rrhh_code del modelo UserProfile).
                Este código identifica de manera única a un usuario en la aplicación de Recursos Humanos de la 
                Universidad de La Laguna, por lo que se emplea como clave para obtener información del usuario 
                mediante la llamada a distintos Web Services.
            </p>
            <pre>python manage.py sync_rrhh</pre>
        </div>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Actualización del Estado del CVN de los usuarios</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>cvn/management/commands/update_all_status_cvn.py</b></div>
            <p>
                Actualiza el Estado del CVN de cada usuario (campo status del modelo CVN). 
                Este estado se calcula a partir de la fecha de expiración (variable EXPIRY_DATE 
                en el Settings de CVN) y la fecha de creación del CVN-PDF.
            </p>
            <pre>python manage.py update_all_status_cvn</pre>
        </div>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Inserción tardía de nuevos CVNs</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>cvn/management/commands/insert_all_cvn.py</b></div>
            <p>
                Cuando un usuario sube un CVN-PDF, válido para la FECYT, sólo se obtiene su representación en XML. 
                Es decir, su producción científica no es almacenada hasta que se realice el parseo, evitando así 
                tiempos de espera elevados en el momento de subir un nuevo documento.
            </p>
            <p>
                Este comando extrae la información de los nuevos CVN-XML de los usuarios y la inserta en la base de datos.
            </p>
            <pre>python manage.py insert_all_cvn</pre>
        </div>
    </div>
</div>

<h1 class="page-header">Tareas Administrativas</h1>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Limpieza de Duplicados</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>cvn/management/commands/find_pairs.py</b></div>
            <p>    
                Busca pares de elementos similares en los CvnItem insertados (posibles duplicados) con el objetivo de 
                unificarlos. Para tal fin, se proporciona un menú que facilita la selección de los mejores campos de 
                los pares, es decir, aquellos que recogen la información más precisa.
            </p>
            <p>
                Por cada par unificado se crea un nuevo elemento relacionado con los usuarios originales, dejando 
                a <i>None</i> los registros originales, que han de ser eliminados.
            </p>
            <p>
                La búsqueda de duplicados puede alargarse demasiado en el tiempo si no se emplea el parámetro <i>year</i>, 
                ya que se realiza una búsqueda todos contra todos, por lo que se recomienda filtrar por años el conjunto 
                de elementos inicial.
            </p>
            <pre>python manage.py find_pairs --document="..." --table="..." --diff="0-7" --year="YYYY"</pre>
            <h5>Parámetros</h5>
            <table class="table table-striped table-condensed">
                <tr>
                    <th>PARÁMETRO</th>
                    <th>DESCRIPCIÓN</th>
                    <th>USO</th>
                    <th>RECOMENDADO</th>
                </tr>
                <tr>
                    <td>document</td>
                    <td>Documento de Identificación (DNI/NIF) de un usuario (campo documento del modelo UserProfile)</td>
                    <td>Limpieza de registros de un único usuario</td>
                    <td>NO</td>
                </tr>
                <tr>
                    <td>table</td>
                    <td>Tabla que se quiere limpiar</td>
                    <td>Los valores posibles son: Proyecto, Articulo, Libro, Capitulo, Congreso, Convenio, TesisDoctoral o Patente</td>
                    <td>SI</td>
                </tr>
                <tr>
                    <td>diff</td>
                    <td>División de Pares de duplicados por el número de campos diferentes</td>
                    <td>Ejecutar con valores de 0 a 7</td>
                    <td>SI</td>
                </tr>
                <tr>
                    <td>year</td>
                    <td>Año asociado al CvnItem</td>
                    <td>Limpieza de registros realizados en el año <i>year</i></td>
                    <td>SI</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Generación de Informes por Departamentos o Áreas</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>cvn/management/commands/dept_report.py</b></div>
            <p>
                Genera un Informe en PDF o CSV con los datos de producción científica de cada departamento 
                o área a partir de la información extraída de diferentes Web Services.
            </p>
            <pre>python manage.py dept_report --year="<YYYY>" --id="X" --type="d|a" --format="pdf|csv"</pre>
            <h5>Parámetros</h5>
            <table class="table table-striped table-condensed">
                <tr>
                    <th>PARÁMETRO</th>
                    <th>DESCRIPCIÓN</th>
                </tr>
                <tr>
                    <td>year</td>
                    <td>El Informe contendrá la información del año <i>year</i></td>
                </tr>
                <tr>
                    <td>id</td>
                    <td>Código interno del Departamento/Área del que se va a hacer el informe. Si no se especifica se obtiene el de todos los Departamentos/Áreas</td>
                </tr>
                <tr>
                    <td>type</td>
                    <td>Permite elegir entre Informe por Departamento (d) o Informe por Áreas (a). Si no se especifica se obtiene el Informe por Departamentos</td>
                </tr>
                <tr>
                    <td>format</td>
                    <td>Permite elegir el formato de salida: PDF o CSV. Si no se especifica se obtiene en PDF</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Generación de CSV para la Migración de usuarios y CVNs</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>cvn/management/commands/generate_csv_migrate_cvn.py</b></div>
            <p>
                Permite la creación de un fichero CSV con la información de los usuarios necesaria para la migración a otras instancias de la aplicación. 
                El formato es el siguiente: nombre de usuario; documento de identidad; ruta del CVN-PDF; nombre; apellidos
            </p>
            <pre>python manage.py generate_csv_migrate_cvn --date="<dd-mm-yyyy>"</pre>
            <h5>Parámetros</h5>
            <table class="table table-striped table-condensed">
                <tr>
                    <th>PARÁMETRO</th>
                    <th>DESCRIPCIÓN</th>
                </tr>
                <tr>
                    <td>date</td>
                    <td>Sólo añade al CSV los usuarios que tengan un CVN-PDF subido con fecha igual o posterior a la fecha indicada</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<div class="section">
    <ul class="nav nav-tabs header">
        <li class="active">Importación de usuarios y CVNs a partir de un CSV de Migración</li>
    </ul>
    <div class="content">
        <div class="row-fluid">
            <div class="alert alert-info"><b>cvn/management/commands/migrate_cvn_from_csv.py</b></div>
            <p>
                Permite importar usuarios y CVNs masivamente en la aplicación desde un CSV, siguiendo el formato del comando <i>generate_csv_migrate_cvn</i>
            </p>
            <p>
                El fichero de Migración debe almacenase en el directorio definido en la variable <i>MIGRATION_ROOT</i> en el Settings de CVN.
            </p>
            <pre>python manage.py migrate_cvn_from_csv</pre>
        </div>
    </div>
</div>
        </div>
    </section>
        </div>
        <div class="col-md-3 sidebar" id="sidebar">




    <div class="panel panel-default panel-ull color-336699">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-external-link-square"></i> Enlaces de interés</h3>
            </div>
            <div class="panel-body">
                <ul class="nav nav-pills nav-stacked" id="links">
                    <li><a href="http://www.ull.es/" target="_blank"> Universidad de La Laguna (ULL)</a></li>
                    <li><a href="http://cvn.fecyt.es/" target="_blank"> CVN de la FECYT</a></li>
                </ul>
            </div>
    </div>
    <div class="panel panel-default panel-ull color-336699">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-copyright"></i> Licencia</h3>
            </div>
            <div class="panel-body">
                <ul class="nav nav-pills nav-stacked">
                    <li><div class="media"><a href="http://www.gnu.org/licenses/agpl-3.0.html" target="_blank">GNU Affero General Public License v3.0</a></div></li>
                    <li><div class="media"><a href="http://www.gnu.org/licenses/agpl-3.0.html" target="_blank"><img alt="AGPL v3.0" class="media-object" style="display: block; margin-left: auto; margin-right: auto;" src="images/agplv3.png"></a></div></li>
                </ul>
            </div>
    </div>
    <div class="panel panel-default panel-ull color-336699">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-cogs"></i> Tecnología</h3>
            </div>
            <div class="panel-body" style="text-align: center;">
                <ul class="nav nav-pills nav-stacked">
                    <li><div class="media"><a href="http://www.djangoproject.com/" target="_blank"><img src="https://www.djangoproject.com/m/img/badges/djangopowered126x54.gif" border="0" alt="Powered by Django." title="Powered by Django."/></a></div></li>
                    <li><div class="media"><a href="https://www.python.org/" target="_blank"><img src="images/python.png" border="0" alt="Python" title="Python"/></a></div></li>
                    <li><div class="media"><a href="http://redis.io/" target="_blank"><img src="images/redis.png" border="0" alt="Redis" title="Redis"/></a></div></li>
                    <li><div class="media"><a href="http://www.reportlab.com/" target="_blank"><img src="images/reportlab.png" border="0" alt="ReportLab" title="ReportLab"/></a></div></li>
                </ul>
            </div>
    </div>
        </div>
    </div>
</div>
<div id="footer">
   <div class="container-fluid">
      <div class="row">
         <div class="col-xs-12">
            <ul class="address pull-left">
                <li><strong>Universidad de La Laguna</strong><br> Pabellón de Gobierno, C/ Molinos de Agua s/n. | San Cristóbal de La Laguna, Santa Cruz de Tenerife - España (38200) | Teléfono: (+34) 922 31 90 00/01</li>
            </ul>
            <ul class="list-inline text-muted pull-right">
                <li><a title="Facebook" target="_blank" href="http://www.facebook.com/universidaddelalaguna"><span class="fa fa-facebook-square"></span></a></li>
                <li><a title="Tuenti" target="_blank" href="http://www.tuenti.com/#m=Page&amp;func=index&amp;page_key=1_160_68944913"><i class="fa fa-tumblr-square"></i></a></li>
                <li><a title="Twitter" target="_blank" href="http://twitter.com/CanalULL"><i class="fa fa-twitter-square"></i></a></li>
                <li><a title="LinkedIn" target="_blank" href="http://www.linkedin.com/groups/Universidad-Laguna-2656178"><i class="fa fa-linkedin-square"></i></a></li>
                <li><a title="Página web ULL" target="_blank" href="http://www.ull.es"><i class="fa fa-globe"></i></a></li>
            </ul>
         </div>
      </div>
   </div>
</div>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="//static.ull.es/v3/dist/js/ull.min.js"></script>

</body>
</html>